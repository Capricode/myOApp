<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="myOApp.Views.BrowsePage"
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:myOApp.Controls"
    xmlns:d="http://xamarin.com/schemas/2014/forms/design"
    xmlns:ffsvg="clr-namespace:FFImageLoading.Svg.Forms;assembly=FFImageLoading.Svg.Forms"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:services="clr-namespace:myOApp.Services"
    x:Name="BrowseEventsPage"
    Title="{Binding Title}"
    BackgroundColor="{DynamicResource MainBackgroundColor}"
    mc:Ignorable="d">
    <!--  See Sessions page in app conference for handling loading and empty message  -->
    <Shell.SearchHandler>
        <services:EventSearchHandler
            BackgroundColor="White"
            DisplayMemberName="Text"
            Placeholder="Search for events..."
            PlaceholderColor="{DynamicResource CaptionContrastTextColor}"
            QueryIconName="Search"
            ShowsResults="true">
            <services:EventSearchHandler.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="10" BackgroundColor="{DynamicResource ContentBackgroundColor}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="0.2*" />
                            <ColumnDefinition Width="0.8*" />
                        </Grid.ColumnDefinitions>
                        <Label
                            Grid.Column="0"
                            HorizontalTextAlignment="Center"
                            Text="{Binding ShortDate}" />
                        <Label
                            Grid.Column="1"
                            FontAttributes="Bold"
                            Text="{Binding Name}" />
                    </Grid>
                </DataTemplate>
            </services:EventSearchHandler.ItemTemplate>
        </services:EventSearchHandler>
    </Shell.SearchHandler>

    <RefreshView Command="{Binding ForceRefreshEventsCommand}" IsRefreshing="{Binding IsRefresh, Mode=TwoWay}">
        <CollectionView x:Name="EventsCollectionView" ItemsSource="{Binding Events}">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout ItemSpacing="1" Orientation="Vertical" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <controls:EventView />
                </DataTemplate>
            </CollectionView.ItemTemplate>
            <CollectionView.EmptyView>
                <StackLayout BackgroundColor="{DynamicResource ContentBackgroundColor}">
                    <Label
                        Margin="10,50,10,10"
                        FontSize="18"
                        HorizontalOptions="Fill"
                        HorizontalTextAlignment="Center"
                        Text="You have not favorited any events yet." />
                    <Label
                        FontSize="12"
                        HorizontalOptions="Fill"
                        HorizontalTextAlignment="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <FormattedString.Spans>
                                    <Span Text="Try tapping the heart next to an event." TextColor="{DynamicResource AccentColor}" />
                                </FormattedString.Spans>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <ffsvg:SvgCachedImage
                        HeightRequest="200"
                        Source="resource://myOApp.Resources.noFavorites.svg"
                        VerticalOptions="CenterAndExpand"
                        WidthRequest="200" />
                </StackLayout>
            </CollectionView.EmptyView>
        </CollectionView>
    </RefreshView>
</ContentPage>